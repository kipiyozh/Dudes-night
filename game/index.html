<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISLAND ESCAPE</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #1a1a2e;
            color: #eee;
            font-family: 'Courier New', monospace;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        h1 {
            color: #e94560;
            margin-bottom: 10px;
            letter-spacing: 4px;
        }

        .game-container {
            display: flex;
            gap: 30px;
            margin-top: 20px;
        }

        /* BIG TIME DISPLAY */
        .time-display {
            text-align: center;
            margin-bottom: 20px;
        }

        .time-big {
            font-size: 64px;
            color: #00ff88;
            font-weight: bold;
            line-height: 1;
        }

        .time-big.warning {
            color: #f4d35e;
        }

        .time-big.danger {
            color: #e94560;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .time-label {
            color: #888;
            font-size: 14px;
            margin-top: 5px;
        }

        /* MAP */
        .map-container {
            position: relative;
        }

        .map {
            display: grid;
            grid-template-columns: repeat(10, 50px);
            grid-template-rows: repeat(10, 50px);
            gap: 2px;
            background: #16213e;
            padding: 10px;
            border-radius: 8px;
        }

        .tile {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .tile:hover {
            transform: scale(1.05);
            z-index: 10;
        }

        .tile.water { background: #0f4c75; }
        .tile.beach { background: #f4d35e; }
        .tile.forest { background: #2d6a4f; }
        .tile.ruins { background: #6c567b; }
        .tile.rocks { background: #5c636a; }

        /* RESOURCE ICONS ON MAP */
        .tile-icon {
            font-size: 22px;
            filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.5));
        }

        .tile.player .tile-icon {
            display: none;
        }

        .tile.player::after {
            content: '';
            width: 30px;
            height: 30px;
            background: #e94560;
            border-radius: 50%;
            box-shadow: 0 0 15px #e94560, 0 0 30px #e94560;
            animation: playerGlow 2s infinite;
        }

        @keyframes playerGlow {
            0%, 100% { box-shadow: 0 0 15px #e94560, 0 0 30px #e94560; }
            50% { box-shadow: 0 0 20px #e94560, 0 0 40px #e94560; }
        }

        .tile.explored {
            opacity: 1;
        }

        .tile.unexplored {
            opacity: 0.3;
        }

        .tile.unexplored .tile-icon {
            display: none;
        }

        /* REACHABLE TILES WITH COST */
        .tile.reachable {
            box-shadow: inset 0 0 0 3px #00ff88;
            cursor: pointer;
        }

        .tile.reachable::before {
            content: attr(data-cost);
            position: absolute;
            top: 2px;
            right: 4px;
            font-size: 11px;
            color: #00ff88;
            font-weight: bold;
            background: rgba(0,0,0,0.7);
            padding: 1px 4px;
            border-radius: 3px;
        }

        .tile.reachable:hover {
            box-shadow: inset 0 0 0 3px #fff;
        }

        /* TOOLTIP */
        .tooltip {
            display: none;
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1a1a2e;
            border: 2px solid #e94560;
            padding: 8px 12px;
            border-radius: 6px;
            white-space: nowrap;
            z-index: 100;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .tile:hover .tooltip {
            display: block;
        }

        .tooltip-title {
            color: #f4d35e;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .tooltip-resources {
            color: #00ff88;
        }

        .tooltip-cost {
            color: #888;
            margin-top: 4px;
        }

        /* PANEL */
        .panel {
            background: #16213e;
            padding: 20px;
            border-radius: 8px;
            min-width: 300px;
        }

        .panel h2 {
            color: #e94560;
            margin-bottom: 15px;
            font-size: 14px;
            letter-spacing: 2px;
        }

        .stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 10px 12px;
            background: #1a1a2e;
            border-radius: 4px;
        }

        .stat-label {
            color: #888;
        }

        .stat-value {
            color: #00ff88;
            font-weight: bold;
        }

        .stat-value.warning {
            color: #f4d35e;
        }

        .stat-value.danger {
            color: #e94560;
        }

        /* PROGRESS BAR */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #1a1a2e;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.3s;
        }

        .progress-fill.hp {
            background: linear-gradient(90deg, #e94560, #00ff88);
        }

        .progress-fill.hunger {
            background: linear-gradient(90deg, #e94560, #f4d35e);
        }

        /* ACTIONS */
        .actions {
            margin-top: 15px;
        }

        .action-btn {
            width: 100%;
            padding: 12px;
            margin-bottom: 8px;
            background: #0f4c75;
            border: none;
            color: #fff;
            font-family: inherit;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .action-btn:hover:not(:disabled) {
            background: #e94560;
            transform: translateY(-2px);
        }

        .action-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .action-cost {
            background: rgba(0,0,0,0.3);
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            color: #f4d35e;
        }

        /* LOG */
        .log {
            margin-top: 20px;
            max-height: 150px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 6px 10px;
            margin-bottom: 4px;
            background: #1a1a2e;
            border-radius: 4px;
            font-size: 12px;
            border-left: 3px solid #0f4c75;
        }

        .log-entry.event {
            border-left-color: #e94560;
        }

        .log-entry.success {
            border-left-color: #00ff88;
        }

        /* INVENTORY */
        .inventory {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .inv-item {
            background: #1a1a2e;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .inv-item .icon {
            font-size: 16px;
        }

        .inv-item span {
            color: #00ff88;
        }

        /* ZONE INFO */
        .zone-info {
            margin-top: 15px;
            padding: 12px;
            background: #1a1a2e;
            border-radius: 4px;
            border-left: 3px solid #f4d35e;
        }

        .zone-name {
            color: #f4d35e;
            font-weight: bold;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .zone-resources {
            color: #00ff88;
            font-size: 13px;
            margin-top: 8px;
        }

        .zone-resources .resource-tag {
            display: inline-block;
            background: rgba(0,255,136,0.1);
            padding: 3px 8px;
            border-radius: 3px;
            margin-right: 5px;
            margin-top: 4px;
        }

        /* NIGHT OVERLAY */
        .night-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 100;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .night-overlay.active {
            display: flex;
        }

        .night-overlay h2 {
            color: #e94560;
            font-size: 72px;
            margin-bottom: 20px;
            letter-spacing: 10px;
        }

        .night-overlay p {
            color: #888;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .night-overlay button {
            padding: 15px 40px;
            font-size: 18px;
        }

        /* LEGEND */
        .legend {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: #888;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }

        /* CONTROLS HINT */
        .controls-hint {
            margin-top: 15px;
            padding: 10px 15px;
            background: #16213e;
            border-radius: 6px;
            font-size: 12px;
            color: #888;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .key {
            background: #0f4c75;
            color: #fff;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 11px;
            margin-right: 3px;
        }
    </style>
</head>
<body>
    <h1>ISLAND ESCAPE</h1>
    <p style="color: #888; margin-bottom: 10px;">–ø–æ—Å—Ç—Ä–æ–π –ø–ª–æ—Ç ‚Äî —Å–±–µ–≥–∏ —Å –æ—Å—Ç—Ä–æ–≤–∞</p>

    <div class="game-container">
        <div class="map-container">
            <div class="map" id="map"></div>
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background:#f4d35e"></div> –ø–ª—è–∂</div>
                <div class="legend-item"><div class="legend-color" style="background:#2d6a4f"></div> –ª–µ—Å</div>
                <div class="legend-item"><div class="legend-color" style="background:#6c567b"></div> —Ä—É–∏–Ω—ã</div>
                <div class="legend-item"><div class="legend-color" style="background:#5c636a"></div> —Å–∫–∞–ª—ã</div>
            </div>
            <div class="controls-hint">
                <span class="key">WASD</span> –¥–≤–∏–∂–µ–Ω–∏–µ
                <span class="key">SPACE</span> —Å–æ–±–∏—Ä–∞—Ç—å
                <span class="key">C</span> –∫—Ä–∞—Ñ—Ç
                <span class="key">R</span> —Ä–∞–∑–≤–µ–¥–∫–∞
            </div>
        </div>

        <div class="panel">
            <h2>// –î–ï–ù–¨ <span id="day-num">1</span></h2>
            
            <div class="time-display">
                <div class="time-big" id="time-big">12</div>
                <div class="time-label">—á–∞—Å–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å</div>
            </div>

            <div class="stat">
                <span class="stat-label">HP</span>
                <span class="stat-value" id="hp">100</span>
            </div>
            <div class="progress-bar"><div class="progress-fill hp" id="hp-bar" style="width:100%"></div></div>

            <div class="stat" style="margin-top: 10px;">
                <span class="stat-label">–≥–æ–ª–æ–¥</span>
                <span class="stat-value" id="hunger">100</span>
            </div>
            <div class="progress-bar"><div class="progress-fill hunger" id="hunger-bar" style="width:100%"></div></div>

            <div class="zone-info">
                <div class="zone-name" id="zone-name">–ø–ª—è–∂</div>
                <div class="zone-resources" id="zone-resources"></div>
            </div>

            <h2 style="margin-top: 20px;">// –ò–ù–í–ï–ù–¢–ê–†–¨</h2>
            <div class="inventory" id="inventory">
                <div class="inv-item" style="color: #888;">–ø—É—Å—Ç–æ</div>
            </div>

            <div class="actions">
                <h2>// –î–ï–ô–°–¢–í–ò–Ø</h2>
                <button class="action-btn" id="btn-explore" onclick="explore()">
                    <span>—Ä–∞–∑–≤–µ–¥–∫–∞ –º–µ—Å—Ç–Ω–æ—Å—Ç–∏</span>
                    <span class="action-cost">3—á</span>
                </button>
                <button class="action-btn" id="btn-gather" onclick="gather()">
                    <span>—Å–æ–±–∏—Ä–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã</span>
                    <span class="action-cost">1—á</span>
                </button>
                <button class="action-btn" id="btn-craft" onclick="openCraft()">
                    <span>–∫—Ä–∞—Ñ—Ç</span>
                    <span class="action-cost">2-4—á</span>
                </button>
                <button class="action-btn" id="btn-rest" onclick="endDay()">
                    <span>–∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–µ–Ω—å</span>
                    <span class="action-cost">—Å–æ–Ω</span>
                </button>
            </div>

            <div class="log" id="log"></div>
        </div>
    </div>

    <div class="night-overlay" id="night-overlay">
        <h2>–ù–û–ß–¨</h2>
        <p id="night-events">—á—Ç–æ-—Ç–æ –¥–≤–∏–∂–µ—Ç—Å—è –≤ —Ç–µ–º–Ω–æ—Ç–µ...</p>
        <button class="action-btn" onclick="startNewDay()">–¥–æ–∂–¥–∞—Ç—å—Å—è —Ä–∞—Å—Å–≤–µ—Ç–∞</button>
    </div>

    <script>
        // === GAME STATE ===
        const state = {
            day: 1,
            time: 12,
            maxTime: 12,
            hp: 100,
            hunger: 100,
            
            playerX: 5,
            playerY: 8,
            
            inventory: {},
            
            explored: new Set(['5,8', '4,8', '6,8', '5,7']), // —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –∑–æ–Ω–∞
            
            craftedItems: new Set(),
            
            // —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ –∫–∞—Ä—Ç–µ (x,y -> —Ä–µ—Å—É—Ä—Å)
            mapResources: {},
        };

        // === RESOURCE ICONS ===
        const RESOURCE_ICONS = {
            '–≤–æ–ª–æ–∫–Ω–∞': 'üåø',
            '–¥–µ—Ä–µ–≤–æ': 'üå≤',
            '–±—Ä—ë–≤–Ω–∞': 'ü™µ',
            '–∫–∞–º–µ–Ω—å': 'ü™®',
            '—Ç–∫–∞–Ω—å': 'üßµ',
            '–ø–∞—Ä—É—Å': '‚õµ',
            '–∫–∞–º–µ–Ω–Ω—ã–π —Ç–æ–ø–æ—Ä': 'ü™ì',
            '–≤–µ—Ä—ë–≤–∫–∞': 'ü™¢',
            '–ø–ª–æ—Ç': 'üö£',
            '–µ–¥–∞': 'üçñ',
        };

        // === MAP CONFIG ===
        const ZONES = {
            water: { name: '–≤–æ–¥–∞', icon: 'üåä', walkable: false, resources: [] },
            beach: { name: '–ø–ª—è–∂', icon: 'üèñÔ∏è', walkable: true, moveCost: 1, resources: ['–≤–æ–ª–æ–∫–Ω–∞'] },
            forest: { name: '–ª–µ—Å', icon: 'üå≤', walkable: true, moveCost: 2, resources: ['–¥–µ—Ä–µ–≤–æ', '–≤–æ–ª–æ–∫–Ω–∞'] },
            ruins: { name: '—Ä—É–∏–Ω—ã', icon: 'üèöÔ∏è', walkable: true, moveCost: 2, resources: ['—Ç–∫–∞–Ω—å', '–∫–∞–º–µ–Ω—å'] },
            rocks: { name: '—Å–∫–∞–ª—ã', icon: 'ü™®', walkable: true, moveCost: 3, resources: ['–∫–∞–º–µ–Ω—å'] },
        };

        // –∫–∞—Ä—Ç–∞ 10x10
        const MAP = [
            ['water','water','water','water','water','water','water','water','water','water'],
            ['water','water','water','rocks','rocks','rocks','water','water','water','water'],
            ['water','water','rocks','rocks','forest','forest','rocks','water','water','water'],
            ['water','rocks','forest','forest','forest','forest','forest','ruins','water','water'],
            ['water','water','forest','forest','forest','forest','ruins','ruins','water','water'],
            ['water','water','forest','forest','forest','forest','forest','water','water','water'],
            ['water','beach','beach','forest','forest','forest','beach','beach','water','water'],
            ['water','beach','beach','beach','beach','beach','beach','beach','water','water'],
            ['water','water','beach','beach','beach','beach','beach','water','water','water'],
            ['water','water','water','water','water','water','water','water','water','water'],
        ];

        // === CRAFTING ===
        const RECIPES = {
            '–∫–∞–º–µ–Ω–Ω—ã–π —Ç–æ–ø–æ—Ä': {
                ingredients: { '–∫–∞–º–µ–Ω—å': 2, '–≤–æ–ª–æ–∫–Ω–∞': 3 },
                time: 2,
                icon: 'ü™ì',
            },
            '–≤–µ—Ä—ë–≤–∫–∞': {
                ingredients: { '–≤–æ–ª–æ–∫–Ω–∞': 3 },
                time: 2,
                icon: 'ü™¢',
            },
            '–ø–ª–æ—Ç': {
                ingredients: { '–±—Ä—ë–≤–Ω–∞': 4, '–≤–µ—Ä—ë–≤–∫–∞': 2, '–ø–∞—Ä—É—Å': 1 },
                time: 4,
                icon: 'üö£',
            }
        };

        // === INIT ===
        function init() {
            generateMapResources();
            renderMap();
            updateUI();
            log('—Ç—ã –æ—á–Ω—É–ª—Å—è –Ω–∞ –ø–ª—è–∂–µ. –Ω–∞–¥–æ –≤—ã–±–∏—Ä–∞—Ç—å—Å—è.');
            log('—Ü–µ–ª—å: –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –ø–ª–æ—Ç –∏ —É–ø–ª—ã—Ç—å.', 'event');
        }

        // –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ –∫–∞—Ä—Ç–µ
        function generateMapResources() {
            for (let y = 0; y < 10; y++) {
                for (let x = 0; x < 10; x++) {
                    const terrain = MAP[y][x];
                    const zone = ZONES[terrain];
                    if (zone.resources.length > 0) {
                        // —Å–ª—É—á–∞–π–Ω—ã–π —Ä–µ—Å—É—Ä—Å –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤ –∑–æ–Ω–µ
                        const resource = zone.resources[Math.floor(Math.random() * zone.resources.length)];
                        state.mapResources[`${x},${y}`] = resource;
                    }
                }
            }
            // –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –ø–∞—Ä—É—Å –≤ —Ä—É–∏–Ω–∞—Ö
            state.mapResources['7,3'] = '—Ç–∫–∞–Ω—å';
            state.mapResources['6,4'] = '–ø–∞—Ä—É—Å';
        }

        // === RENDER MAP ===
        function renderMap() {
            const mapEl = document.getElementById('map');
            mapEl.innerHTML = '';
            
            for (let y = 0; y < 10; y++) {
                for (let x = 0; x < 10; x++) {
                    const tile = document.createElement('div');
                    const terrain = MAP[y][x];
                    const zone = ZONES[terrain];
                    const key = `${x},${y}`;
                    
                    tile.className = `tile ${terrain}`;
                    
                    // explored?
                    const isExplored = state.explored.has(key);
                    if (isExplored) {
                        tile.classList.add('explored');
                    } else {
                        tile.classList.add('unexplored');
                    }
                    
                    // resource icon
                    const resource = state.mapResources[key];
                    if (resource && isExplored) {
                        const icon = document.createElement('span');
                        icon.className = 'tile-icon';
                        icon.textContent = RESOURCE_ICONS[resource] || '?';
                        tile.appendChild(icon);
                    }
                    
                    // player?
                    if (x === state.playerX && y === state.playerY) {
                        tile.classList.add('player');
                    }
                    
                    // reachable?
                    const isReachable = zone.walkable && canReach(x, y);
                    if (isReachable) {
                        tile.classList.add('reachable');
                        tile.setAttribute('data-cost', zone.moveCost + '—á');
                        tile.onclick = () => moveTo(x, y);
                    }
                    
                    // tooltip
                    if (zone.walkable && isExplored) {
                        const tooltip = document.createElement('div');
                        tooltip.className = 'tooltip';
                        tooltip.innerHTML = `
                            <div class="tooltip-title">${zone.icon} ${zone.name}</div>
                            ${resource ? `<div class="tooltip-resources">${RESOURCE_ICONS[resource]} ${resource}</div>` : ''}
                            ${isReachable ? `<div class="tooltip-cost">–ø–µ—Ä–µ—Ö–æ–¥: ${zone.moveCost}—á</div>` : ''}
                        `;
                        tile.appendChild(tooltip);
                    }
                    
                    mapEl.appendChild(tile);
                }
            }
        }

        // === MOVEMENT ===
        function canReach(x, y) {
            const dx = Math.abs(x - state.playerX);
            const dy = Math.abs(y - state.playerY);
            return (dx <= 1 && dy <= 1) && !(dx === 0 && dy === 0);
        }

        function moveTo(x, y) {
            const terrain = MAP[y][x];
            const zone = ZONES[terrain];
            
            if (!zone.walkable) return;
            
            const cost = zone.moveCost;
            if (state.time < cost) {
                log('–Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–∏!', 'event');
                return;
            }
            
            state.time -= cost;
            state.playerX = x;
            state.playerY = y;
            
            const key = `${x},${y}`;
            const wasExplored = state.explored.has(key);
            state.explored.add(key);
            
            log(`–ø–µ—Ä–µ—à—ë–ª –≤: ${zone.name} (-${cost}—á)`);
            
            if (!wasExplored) {
                log('–Ω–æ–≤–∞—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∞', 'success');
            }
            
            updateUI();
            renderMap();
            
            if (state.time <= 0) {
                endDay();
            }
        }

        // === ACTIONS ===
        function explore() {
            if (state.time < 3) {
                log('–Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–∏!', 'event');
                return;
            }
            
            state.time -= 3;
            
            // –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Å–æ—Å–µ–¥–Ω–∏–µ –∫–ª–µ—Ç–∫–∏
            for (let dy = -1; dy <= 1; dy++) {
                for (let dx = -1; dx <= 1; dx++) {
                    const nx = state.playerX + dx;
                    const ny = state.playerY + dy;
                    if (nx >= 0 && nx < 10 && ny >= 0 && ny < 10) {
                        state.explored.add(`${nx},${ny}`);
                    }
                }
            }
            
            log('–æ—Å–º–æ—Ç—Ä–µ–ª –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏ (-3—á)', 'success');
            updateUI();
            renderMap();
        }

        function gather() {
            if (state.time < 1) {
                log('–Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–∏!', 'event');
                return;
            }
            
            const key = `${state.playerX},${state.playerY}`;
            const resource = state.mapResources[key];
            
            if (!resource) {
                log('—Ç—É—Ç –Ω–µ—á–µ–≥–æ —Å–æ–±–∏—Ä–∞—Ç—å', 'event');
                return;
            }
            
            // –¥–ª—è –¥–µ—Ä–µ–≤–∞ –Ω—É–∂–µ–Ω —Ç–æ–ø–æ—Ä
            if (resource === '–¥–µ—Ä–µ–≤–æ' && !state.craftedItems.has('–∫–∞–º–µ–Ω–Ω—ã–π —Ç–æ–ø–æ—Ä')) {
                log('–Ω—É–∂–µ–Ω —Ç–æ–ø–æ—Ä —á—Ç–æ–±—ã —Ä—É–±–∏—Ç—å –¥–µ—Ä–µ–≤—å—è!', 'event');
                return;
            }
            
            state.time -= 1;
            
            if (resource === '–¥–µ—Ä–µ–≤–æ') {
                addItem('–±—Ä—ë–≤–Ω–∞', 1);
                log(`ü™µ —Å—Ä—É–±–∏–ª –¥–µ—Ä–µ–≤–æ, –ø–æ–ª—É—á–∏–ª –±—Ä—ë–≤–Ω–∞ (-1—á)`, 'success');
            } else if (resource === '–ø–∞—Ä—É—Å') {
                addItem('–ø–∞—Ä—É—Å', 1);
                log(`‚õµ –Ω–∞—à—ë–ª –ø–∞—Ä—É—Å! (-1—á)`, 'success');
            } else {
                const icon = RESOURCE_ICONS[resource] || '';
                addItem(resource, 1);
                log(`${icon} —Å–æ–±—Ä–∞–ª ${resource} (-1—á)`, 'success');
            }
            
            // —Ä–µ—Å—É—Ä—Å —Å–æ–±—Ä–∞–Ω ‚Äî –Ω–æ–≤—ã–π —Å–ª—É—á–∞–π–Ω—ã–π –∏–ª–∏ –ø—É—Å—Ç–æ
            const terrain = MAP[state.playerY][state.playerX];
            const zone = ZONES[terrain];
            if (zone.resources.length > 0 && Math.random() > 0.3) {
                // 70% —à–∞–Ω—Å —á—Ç–æ –ø–æ—è–≤–∏—Ç—Å—è –Ω–æ–≤—ã–π —Ä–µ—Å—É—Ä—Å
                state.mapResources[key] = zone.resources[Math.floor(Math.random() * zone.resources.length)];
            } else {
                delete state.mapResources[key];
            }
            
            updateUI();
            renderMap();
        }

        function addItem(name, count) {
            state.inventory[name] = (state.inventory[name] || 0) + count;
        }

        function openCraft() {
            const options = Object.keys(RECIPES);
            
            let msg = '–ß–¢–û –ö–†–ê–§–¢–ò–¢–¨?\n\n';
            options.forEach((name, i) => {
                const recipe = RECIPES[name];
                const icon = recipe.icon || '?';
                
                // –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
                const ingredients = Object.entries(recipe.ingredients).map(([item, count]) => {
                    const have = state.inventory[item] || 0;
                    const itemIcon = RESOURCE_ICONS[item] || '';
                    const status = have >= count ? '‚úì' : '‚úó';
                    return `${itemIcon}${item} ${have}/${count} ${status}`;
                });
                
                // –º–æ–∂–µ–º –ª–∏ —Å–∫—Ä–∞—Ñ—Ç–∏—Ç—å?
                const canCraft = Object.entries(recipe.ingredients).every(
                    ([item, count]) => (state.inventory[item] || 0) >= count
                );
                const hasTime = state.time >= recipe.time;
                
                let status = '';
                if (!canCraft) status = ' [–Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç —Ä–µ—Å—É—Ä—Å–æ–≤]';
                else if (!hasTime) status = ' [–Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–∏]';
                else status = ' [–ú–û–ñ–ù–û]';
                
                msg += `${i + 1}. ${icon} ${name} (${recipe.time}—á)${status}\n`;
                msg += `   ${ingredients.join(', ')}\n\n`;
            });
            
            msg += '\n–í–≤–µ–¥–∏ –Ω–æ–º–µ—Ä (1-' + options.length + '):';
            
            const choice = prompt(msg);
            if (!choice) return;
            
            const idx = parseInt(choice) - 1;
            if (idx < 0 || idx >= options.length) return;
            
            craft(options[idx]);
        }

        function craft(itemName) {
            const recipe = RECIPES[itemName];
            if (!recipe) return;
            
            // –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
            for (const [item, count] of Object.entries(recipe.ingredients)) {
                if ((state.inventory[item] || 0) < count) {
                    log(`–Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç: ${item}`, 'event');
                    return;
                }
            }
            
            // –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏
            if (state.time < recipe.time) {
                log('–Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–∏!', 'event');
                return;
            }
            
            // —Ç—Ä–∞—Ç–∏–º –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
            for (const [item, count] of Object.entries(recipe.ingredients)) {
                state.inventory[item] -= count;
                if (state.inventory[item] <= 0) {
                    delete state.inventory[item];
                }
            }
            
            // —Ç—Ä–∞—Ç–∏–º –≤—Ä–µ–º—è
            state.time -= recipe.time;
            
            // –ø–æ–ª—É—á–∞–µ–º –ø—Ä–µ–¥–º–µ—Ç
            state.craftedItems.add(itemName);
            addItem(itemName, 1);
            
            log(`—Å–∫—Ä–∞—Ñ—Ç–∏–ª: ${itemName} (-${recipe.time}—á)`, 'success');
            
            // WIN CONDITION
            if (itemName === '–ø–ª–æ—Ç') {
                setTimeout(() => {
                    alert('–¢–´ –ü–û–°–¢–†–û–ò–õ –ü–õ–û–¢ –ò –°–ë–ï–ñ–ê–õ –° –û–°–¢–†–û–í–ê!\n\n–ü–û–ë–ï–î–ê!');
                    location.reload();
                }, 500);
            }
            
            updateUI();
        }

        // === DAY/NIGHT ===
        function endDay() {
            document.getElementById('night-overlay').classList.add('active');
            
            // –Ω–æ—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
            const events = [];
            
            // –≥–æ–ª–æ–¥
            state.hunger -= 20;
            if (state.hunger <= 0) {
                state.hunger = 0;
                state.hp -= 20;
                events.push('—Ç—ã –≥–æ–ª–æ–¥–∞–µ—à—å. -20 HP');
            }
            
            // —Å–ª—É—á–∞–π–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
            if (Math.random() < 0.3) {
                events.push('—á—Ç–æ-—Ç–æ —à—É—Ä—à–∞–ª–æ –≤ —Ç–µ–º–Ω–æ—Ç–µ...');
            }
            
            document.getElementById('night-events').textContent = 
                events.length > 0 ? events.join('\n') : '–Ω–æ—á—å –ø—Ä–æ—à–ª–∞ —Å–ø–æ–∫–æ–π–Ω–æ.';
        }

        function startNewDay() {
            document.getElementById('night-overlay').classList.remove('active');
            
            state.day++;
            state.time = state.maxTime;
            
            log(`=== –î–ï–ù–¨ ${state.day} ===`, 'event');
            
            if (state.hp <= 0) {
                alert('–¢–´ –£–ú–ï–†\n\n–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.');
                location.reload();
                return;
            }
            
            updateUI();
            renderMap();
        }

        // === UI ===
        function updateUI() {
            document.getElementById('day-num').textContent = state.day;
            
            // big time display
            const timeBig = document.getElementById('time-big');
            timeBig.textContent = state.time;
            timeBig.className = 'time-big' + 
                (state.time <= 2 ? ' danger' : state.time <= 4 ? ' warning' : '');
            
            // HP
            const hpEl = document.getElementById('hp');
            hpEl.textContent = state.hp;
            hpEl.className = 'stat-value' + (state.hp < 30 ? ' danger' : state.hp < 60 ? ' warning' : '');
            document.getElementById('hp-bar').style.width = state.hp + '%';
            
            // Hunger
            const hungerEl = document.getElementById('hunger');
            hungerEl.textContent = state.hunger;
            hungerEl.className = 'stat-value' + (state.hunger < 30 ? ' danger' : state.hunger < 60 ? ' warning' : '');
            document.getElementById('hunger-bar').style.width = state.hunger + '%';
            
            // zone info
            const terrain = MAP[state.playerY][state.playerX];
            const zone = ZONES[terrain];
            const currentResource = state.mapResources[`${state.playerX},${state.playerY}`];
            
            document.getElementById('zone-name').innerHTML = `${zone.icon} ${zone.name}`;
            
            const zoneResourcesEl = document.getElementById('zone-resources');
            if (currentResource) {
                const icon = RESOURCE_ICONS[currentResource] || '?';
                zoneResourcesEl.innerHTML = `
                    –∑–¥–µ—Å—å –º–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å:
                    <span class="resource-tag">${icon} ${currentResource}</span>
                    <span style="color:#888">(1—á)</span>
                `;
            } else {
                zoneResourcesEl.innerHTML = '<span style="color:#888">—Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–µ—Ç</span>';
            }
            
            // inventory
            const invEl = document.getElementById('inventory');
            const items = Object.entries(state.inventory);
            if (items.length === 0) {
                invEl.innerHTML = '<div class="inv-item" style="color: #888;">–ø—É—Å—Ç–æ</div>';
            } else {
                invEl.innerHTML = items
                    .map(([name, count]) => {
                        const icon = RESOURCE_ICONS[name] || '?';
                        return `<div class="inv-item"><span class="icon">${icon}</span>${name} <span>x${count}</span></div>`;
                    })
                    .join('');
            }
            
            // buttons
            document.getElementById('btn-explore').disabled = state.time < 3;
            document.getElementById('btn-gather').disabled = state.time < 1;
        }

        function log(msg, type = '') {
            const logEl = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = 'log-entry ' + type;
            entry.textContent = msg;
            logEl.insertBefore(entry, logEl.firstChild);
            
            // keep only last 20 entries
            while (logEl.children.length > 20) {
                logEl.removeChild(logEl.lastChild);
            }
        }

        // === KEYBOARD CONTROLS ===
        document.addEventListener('keydown', (e) => {
            // –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –µ—Å–ª–∏ –Ω–æ—á—å
            if (document.getElementById('night-overlay').classList.contains('active')) {
                if (e.key === ' ' || e.key === 'Enter') {
                    startNewDay();
                }
                return;
            }
            
            let dx = 0, dy = 0;
            
            switch(e.key) {
                case 'ArrowUp':
                case 'w':
                case 'W':
                case '—Ü':
                case '–¶':
                    dy = -1;
                    break;
                case 'ArrowDown':
                case 's':
                case 'S':
                case '—ã':
                case '–´':
                    dy = 1;
                    break;
                case 'ArrowLeft':
                case 'a':
                case 'A':
                case '—Ñ':
                case '–§':
                    dx = -1;
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                case '–≤':
                case '–í':
                    dx = 1;
                    break;
                case ' ': // –ø—Ä–æ–±–µ–ª ‚Äî —Å–æ–±–∏—Ä–∞—Ç—å
                case 'e':
                case 'E':
                case '—É':
                case '–£':
                    e.preventDefault();
                    gather();
                    return;
                case 'c':
                case 'C':
                case '—Å':
                case '–°':
                    openCraft();
                    return;
                case 'r':
                case 'R':
                case '–∫':
                case '–ö':
                    explore();
                    return;
            }
            
            if (dx !== 0 || dy !== 0) {
                e.preventDefault();
                const newX = state.playerX + dx;
                const newY = state.playerY + dy;
                
                // –ø—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã
                if (newX >= 0 && newX < 10 && newY >= 0 && newY < 10) {
                    const terrain = MAP[newY][newX];
                    const zone = ZONES[terrain];
                    if (zone.walkable) {
                        moveTo(newX, newY);
                    }
                }
            }
        });

        // === START ===
        init();
        
        // –ø–æ–¥—Å–∫–∞–∑–∫–∞
        log('—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: —Å—Ç—Ä–µ–ª–∫–∏/WASD ‚Äî –¥–≤–∏–∂–µ–Ω–∏–µ', 'event');
        log('–ü–†–û–ë–ï–õ/E ‚Äî —Å–æ–±–∏—Ä–∞—Ç—å, C ‚Äî –∫—Ä–∞—Ñ—Ç, R ‚Äî —Ä–∞–∑–≤–µ–¥–∫–∞', 'event');
    </script>
</body>
</html>
